"use strict";var c=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var f=Object.prototype.hasOwnProperty;var R=(e,t)=>{for(var s in t)c(e,s,{get:t[s],enumerable:!0})},w=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of h(t))!f.call(e,n)&&n!==s&&c(e,n,{get:()=>t[n],enumerable:!(r=m(t,n))||r.enumerable});return e};var B=e=>w(c({},"__esModule",{value:!0}),e);var T={};R(T,{default:()=>u});module.exports=B(T);var p=require("@raycast/api"),x={newest:"-created",oldest:"created","name-asc":"title","name-desc":"-title",relevance:"score"};async function u(e={}){let t=(0,p.getPreferenceValues)(),s=e.collectionId??0,r=y(e.limit??10,1,50),n=new URL(`https://api.raindrop.io/rest/v1/raindrops/${s}`);n.searchParams.set("perpage",r.toString());let l=e.sort?x[e.sort]:t.sortBy||"-created";l&&n.searchParams.set("sort",l);let i=[];e.query&&i.push(e.query),e.tags?.length&&i.push(...e.tags.filter(Boolean).map(o=>`#"${o}"`)),i.length&&n.searchParams.set("search",i.join(" ").trim());let a=await fetch(n.toString(),{headers:{Authorization:`Bearer ${t.token}`}});if(!a.ok)throw new Error(`Failed to search bookmarks: ${a.statusText}`);let d=(await a.json()).items.slice(0,r),g;return d.some(o=>o.collection?.$id&&!o.collection?.title)&&(g=await P(t.token)),d.map(o=>I(o,g))}function y(e,t,s){return Math.max(t,Math.min(e,s))}function I(e,t){let s=e.collection?.$id??-1,r=e.collection?.title??t?.[s]??(s===-1?"Unsorted":"Unknown");return{id:e._id,title:e.title,url:e.link,excerpt:e.excerpt??"",note:e.note??"",tags:e.tags??[],collectionId:s,collectionTitle:r,created:e.created,lastUpdate:e.lastUpdate,highlights:e.highlights?.map(n=>({text:n.text,note:n.note}))??[]}}async function P(e){try{let t=await fetch("https://api.raindrop.io/rest/v1/collections/all",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)return{};let s=await t.json();return Object.fromEntries(s.items.map(r=>[r._id,r.title]))}catch{return{}}}
